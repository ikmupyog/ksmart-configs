serviceMaps:
  serviceName: death-services
  mappings:
    - version: 1.0
      description: Persists deathCertificate details in eg_death_cert_request  table
      fromTopic: save-deathcertificate-topic
      isTransaction: true
      queryMaps:
        - query: INSERT INTO public.eg_death_cert_request(
                 id, ack_no, createdby, createdtime, deathdtlid, filestoreid, lastmodifiedtime, lastmodifiedby, status, 
                 embeddedurl, dateofissue, counter,certificate_no)
                 VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: deathCertificate
          jsonMaps:
            - jsonPath: $.deathCertificate.id

            - jsonPath: $.deathCertificate.ackNo

            - jsonPath: $.deathCertificate.auditDetails.createdBy

            - jsonPath: $.deathCertificate.auditDetails.createdTime

            - jsonPath: $.deathCertificate.deathDtlId

            - jsonPath: $.deathCertificate.filestoreid

            - jsonPath: $.deathCertificate.auditDetails.lastModifiedTime

            - jsonPath: $.deathCertificate.auditDetails.lastModifiedBy

            - jsonPath: $.deathCertificate.applicationStatus

            # - jsonPath: $.deathCertificate.additionaldetail

            - jsonPath: $.deathCertificate.embeddedUrl

            - jsonPath: $.deathCertificate.dateofissue

            - jsonPath: $.deathCertificate.counter

            - jsonPath: $.deathCertificate.deathcertificateno

        - query: INSERT INTO eg_death_cert_request_audit SELECT * FROM eg_death_cert_request WHERE id = ?;
          basePath: deathCertificate
          jsonMaps:

              - jsonPath: $.deathCertificate.id

    - version: 1.0
      description: Persists death certificate details in eg_death_cert_request,eg_death_cert_request_audit table      
      fromTopic: update-deathcertificate-topic
      isTransaction: true   
      queryMaps:       
        - query: INSERT INTO eg_death_cert_request_audit SELECT * FROM eg_death_cert_request WHERE deathDtlId = ?;
          basePath: deathCertificate
          jsonMaps:
              - jsonPath: $.deathCertificate.deathDtlId

        - query: UPDATE public.eg_death_cert_request
                SET  ack_no=?, createdby=?, createdtime=?, filestoreid=?, lastmodifiedtime=?, lastmodifiedby=?, 
                status=?, embeddedurl=?, dateofissue=?, counter=?
                 WHERE deathDtlId=?;
          basePath: deathCertificate
          jsonMaps:
            - jsonPath: $.deathCertificate.ackNo

            - jsonPath: $.deathCertificate.auditDetails.createdBy

            - jsonPath: $.deathCertificate.auditDetails.createdTime

            - jsonPath: $.deathCertificate.filestoreid

            - jsonPath: $.deathCertificate.auditDetails.lastModifiedTime

            - jsonPath: $.deathCertificate.auditDetails.lastModifiedBy

            - jsonPath: $.deathCertificate.applicationStatus

            # - jsonPath: $.deathCertificate.additionaldetail

            - jsonPath: $.deathCertificate.embeddedUrl

            - jsonPath: $.deathCertificate.dateofissue

            - jsonPath: $.deathCertificate.counter

            - jsonPath: $.deathCertificate.deathDtlId
